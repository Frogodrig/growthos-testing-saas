RequirementID,Category,Title,Description,Status,PhaseID,CreatedAt,UpdatedAt
INTG-001,INTG,"Integrate Resend for transactional email","Replace the stub EmailAction in /packages/action-layer/src/actions/email.ts with a real Resend (resend.com) integration. Add resend npm package to action-layer dependencies. Use RESEND_API_KEY env var. Send real emails with to/subject/body from ActionRequest payload. Maintain tenant isolation by including tenantId in email metadata. Log every send attempt (success or failure) with timestamp. Return ActionResult with success status and messageId. Keep integration minimal — no templates, no batching, no retries in v1.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-002,INTG,"Integrate Google Calendar API for meeting booking","Replace the stub CalendarAction in /packages/action-layer/src/actions/calendar.ts with real Google Calendar API integration. Add googleapis npm package. Use service account credentials via GOOGLE_CALENDAR_CREDENTIALS env var. Create real calendar events with leadId, scheduledAt, and duration from payload. Each tenant needs a calendarId config (store on Tenant model or env). Return ActionResult with success status and event link. Keep minimal — no recurring events, no attendee management in v1.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-003,INTG,"Integrate Stripe Subscriptions for billing","Add Stripe billing integration. Add stripe npm package to action-layer dependencies. Use STRIPE_SECRET_KEY and STRIPE_WEBHOOK_SECRET env vars. Implement: create Stripe customer on tenant creation, create checkout session for subscription, handle subscription.created/updated/deleted webhook events to toggle tenant active status. Add stripeCustomerId and subscriptionStatus fields to Tenant Prisma model. This is the billing foundation — not a full action handler but a service consumed by the tenant activation layer (PH-002). Keep minimal — one plan per SaaS, no usage-based billing in v1.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-004,INTG,"Replace stub webhook handler with real HTTP delivery","Replace the stub WebhookAction in /packages/action-layer/src/actions/webhook.ts with real HTTP webhook delivery. Use native fetch (Node 18+) to POST/PUT to the configured URL with the payload body. Include tenantId and timestamp in webhook headers. Return ActionResult with success/failure and HTTP status code. Log every delivery attempt. No retry logic in v1 — just fire and log.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-005,INTG,"Add external action logging to AgentLog table","Ensure every external action (email send, calendar booking, webhook fire, Stripe call) is logged to the AgentLog table in Prisma with: tenantId, action type, payload summary, success/failure, duration, and timestamp. Modify the ActionLayer.execute() wrapper in /packages/action-layer/src/index.ts to log after each action completes. This provides an audit trail of all external interactions per tenant.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-006,INTG,"Update env configuration for integration secrets","Add all new integration environment variables to infrastructure/env.example and .env: RESEND_API_KEY, GOOGLE_CALENDAR_CREDENTIALS, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, STRIPE_PRICE_ID_BOOKER, STRIPE_PRICE_ID_LEADQUALIFIER, STRIPE_PRICE_ID_FOLLOWUP. Document each variable with a comment. Ensure the 3 SaaS wrappers can access these via process.env.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
INTG-007,INTG,"Update metrics endpoint with real integration data","Update /services/api-gateway/src/routes/metrics.ts to replace TODO stubs (mrr: 0, churn: 0) with real queries. Calculate MRR from active Stripe subscriptions. Calculate churn from cancelled subscriptions. Count actual emails sent, meetings booked, and webhooks fired from AgentLog records. Keep queries simple — direct Prisma counts, no aggregation pipelines.",Done,PH-001,2026-02-13T08:35:00.000Z,2026-02-13T11:15:00.000Z
ACTV-001,ACTV,"Create POST /api/tenant/create endpoint","Create a new route file /services/api-gateway/src/routes/tenant.ts with a POST /api/tenant/create endpoint. This is the production tenant creation flow (replaces /dev/bootstrap). Accept: name, email, password (optional for v1 — can default). Create Tenant in Prisma with plan='free' and subscriptionStatus='none'. Create a Stripe customer via createStripeCustomer() from action-layer and store stripeCustomerId on the Tenant. Create the admin User linked to the tenant. Generate and return a JWT token. Register this route in the api-gateway index.ts. This endpoint must NOT require auth (it's the signup flow). Keep minimal — no email verification, no password hashing in v1.",Done,PH-002,2026-02-13T11:20:00.000Z,2026-02-13T11:25:00.000Z
ACTV-002,ACTV,"Create POST /api/billing/checkout endpoint","Add a POST /api/billing/checkout endpoint to tenant.ts routes. This endpoint REQUIRES auth (tenant must exist and be logged in). Read the tenant's stripeCustomerId from Prisma. Determine the correct STRIPE_PRICE_ID based on which SaaS app is running (use SaaSConfig.slug to map: booker→STRIPE_PRICE_ID_BOOKER, leadqualifier→STRIPE_PRICE_ID_LEADQUALIFIER, followup→STRIPE_PRICE_ID_FOLLOWUP). Call createCheckoutSession() from action-layer with success/cancel URLs from request body. Return the checkout URL. Keep minimal — no plan selection UI, one plan per SaaS.",Done,PH-002,2026-02-13T11:20:00.000Z,2026-02-13T11:25:00.000Z
ACTV-003,ACTV,"Create Stripe webhook handler endpoint","Add a POST /api/stripe/webhook endpoint. This endpoint must NOT require auth — Stripe calls it directly. Accept raw body (configure Fastify to not parse JSON for this route). Use constructWebhookEvent() to validate the signature. Use parseSubscriptionEvent() to extract subscription data. On subscription created/updated: find tenant by stripeCustomerId and update subscriptionStatus. On subscription deleted: set subscriptionStatus to 'canceled'. Log all webhook events to console. Keep minimal — no retry handling, no idempotency checks in v1.",Done,PH-002,2026-02-13T11:20:00.000Z,2026-02-13T11:25:00.000Z
ACTV-004,ACTV,"Add subscription enforcement middleware","Add middleware to the api-gateway that checks tenant subscriptionStatus before allowing access to /api/* routes (except /api/tenant/create and /api/billing/checkout which must remain open). Read the tenant from Prisma using tenantId from JWT. If subscriptionStatus is 'none' or 'canceled' — return 403 with message 'Active subscription required'. Allow 'active' and 'trialing' statuses through. Skip enforcement entirely for /dev/* routes in non-production. Add this as a Fastify onRequest hook after auth middleware.",Done,PH-002,2026-02-13T11:20:00.000Z,2026-02-13T11:25:00.000Z
ACTV-005,ACTV,"Wire tenant routes into all 3 SaaS apps","Register the new tenant routes (tenant create, billing checkout, stripe webhook) in the api-gateway index.ts. Ensure the Stripe webhook route is excluded from both auth and subscription enforcement middleware. Pass SaaSConfig to the tenant route registration so it can determine the correct price ID. Verify all 3 SaaS wrappers (saas-booker, saas-leadqualifier, saas-followup) inherit these routes. Test the full flow: create tenant → checkout → webhook → access granted.",Done,PH-002,2026-02-13T11:20:00.000Z,2026-02-13T11:25:00.000Z
MACT-001,MACT,"Add PAYMENT_MODE environment flag","Add PAYMENT_MODE environment variable to infrastructure/env.example, .env, and .env.production. Allowed values: 'stripe' (default) and 'manual'. Add to all 3 Railway services. When not set, must default to 'stripe' so existing behavior is unchanged. Document the variable with a comment explaining its purpose. This is a configuration-only change — no logic modification.",Done,PH-004,2026-02-14T07:55:00.000Z,2026-02-14T09:30:00.000Z
MACT-002,MACT,"Modify subscription gate middleware for manual mode","Modify the subscription enforcement middleware in /services/api-gateway/src/index.ts. When PAYMENT_MODE=manual: allow 'active' and 'pending' through (pending = signed up but not yet manually activated, active = manually activated). When PAYMENT_MODE=stripe: keep existing behavior (allow 'active' and 'trialing'). The 'none' status should remain blocked in both modes in production. Also modify POST /api/tenant/create in /services/api-gateway/src/routes/tenant.ts: when PAYMENT_MODE=manual, set initial subscriptionStatus to 'pending' instead of 'none', and skip Stripe customer creation. Do NOT delete any existing Stripe logic — wrap it in if (process.env.PAYMENT_MODE !== 'manual') conditional. Do NOT modify database schema.",Done,PH-004,2026-02-14T07:55:00.000Z,2026-02-14T09:30:00.000Z
MACT-003,MACT,"Create POST /internal/activate-tenant admin endpoint","Create a new route POST /internal/activate-tenant in /services/api-gateway/src/routes/tenant.ts. This endpoint must ONLY be registered when PAYMENT_MODE=manual. Protected by ADMIN_SECRET header — request must include header X-Admin-Secret matching ADMIN_SECRET env var. Accepts JSON body { tenant_id: string }. Finds tenant by ID in Prisma, sets subscriptionStatus to 'active', logs activation event to console with timestamp and tenant_id. Returns { success: true, tenant_id, status: 'active' }. If tenant not found → 404. If secret missing/wrong → 401. This endpoint must be auth-exempt and subscription-exempt. Do NOT expose a tenant list. Do NOT log the admin secret value.",Done,PH-004,2026-02-14T07:55:00.000Z,2026-02-14T09:30:00.000Z
MACT-004,MACT,"Wrap Stripe webhook activation in PAYMENT_MODE conditional","Modify the POST /api/stripe/webhook handler in /services/api-gateway/src/routes/tenant.ts. Wrap the entire webhook handler body in if (process.env.PAYMENT_MODE !== 'manual'). When PAYMENT_MODE=manual: the endpoint should still exist but return { status: 'ignored', reason: 'manual activation mode' } without processing the webhook. Do NOT delete any Stripe code. Do NOT refactor the billing service. The conditional must be a simple wrapper around existing logic so removing it later restores full Stripe behavior.",Done,PH-004,2026-02-14T07:55:00.000Z,2026-02-14T09:30:00.000Z
MACT-005,MACT,"Update metrics and health responses for manual mode","Modify /services/api-gateway/src/routes/metrics.ts: when PAYMENT_MODE=manual, set activationMode to 'manual' in the response and label manually activated tenants as 'Manually Activated' instead of 'active'. Modify the /health endpoint response to include paymentMode field showing current PAYMENT_MODE value. This provides visibility into which mode the system is operating in. Do NOT redesign any UI. Only add conditional labels to existing JSON responses.",Done,PH-004,2026-02-14T07:55:00.000Z,2026-02-14T09:30:00.000Z
TBND-001,TBND,"Add saasProduct column to Tenant Prisma model","Add a saasProduct String field (optional, nullable) to the Tenant model in infrastructure/prisma/schema.prisma. Default to null for backwards compatibility with existing tenants. Allowed values: 'saas-booker', 'saas-leadqualifier', 'saas-followup'. Add an index on [saasProduct] for analytics queries. Run prisma db push or generate migration. Do NOT modify any other models. Do NOT add foreign keys or enum types — keep it a plain String field.",Done,PH-005,2026-02-14T10:00:00.000Z,2026-02-14T10:30:00.000Z
TBND-002,TBND,"Set saasProduct on tenant creation","Modify POST /api/tenant/create in /services/api-gateway/src/routes/tenant.ts. Read saasConfig.slug from the SaaSConfig passed to registerTenantRoutes(). Set saasProduct: saasConfig.slug in the Prisma tenant.create() data. This binds the tenant to the product they signed up on. Include saasProduct in the response body. Do NOT modify existing tenants. Do NOT add saasProduct to any other creation flow.",Done,PH-005,2026-02-14T10:00:00.000Z,2026-02-14T10:30:00.000Z
TBND-003,TBND,"Add saasProduct to JWT payload and AuthPayload type","Modify the AuthPayload interface in packages/shared-types/src/index.ts to add saasProduct: string (optional for backwards compat). Modify generateToken() in services/api-gateway/src/middleware/auth.ts to include saasProduct from the tenant record when generating tokens. Modify POST /api/tenant/create to include saasProduct in the token payload. Existing tokens without saasProduct must still pass auth (backwards compatible). Do NOT change token expiration or signing algorithm.",Done,PH-005,2026-02-14T10:00:00.000Z,2026-02-14T10:30:00.000Z
TBND-004,TBND,"Add product-scope enforcement middleware","Add a new onRequest hook in /services/api-gateway/src/index.ts that runs AFTER auth middleware. If the JWT contains a saasProduct field and it does NOT match the running SaaSConfig.slug — return 403 with { error: 'Token not valid for this product', expected: <slug>, got: <token.saasProduct> }. If saasProduct is ABSENT from the token (legacy/pre-PH-005 token): look up the tenant's saasProduct from Prisma using auth.tenantId. If the DB tenant now HAS a saasProduct set (not null) — return 401 with { error: 'Token outdated — please re-authenticate' }. If the DB tenant also has null saasProduct (true legacy, never re-created) — allow through. This ensures old tokens are invalidated once a tenant gets product-bound. The subscription enforcement hook already does a Prisma lookup, so this can share the same query by selecting saasProduct alongside subscriptionStatus — or run its own lightweight query. Skip this check for auth-exempt and subscription-exempt paths. This prevents both cross-product token reuse AND stale-token bypass.",Done,PH-005,2026-02-14T10:00:00.000Z,2026-02-14T10:30:00.000Z
TBND-005,TBND,"Add product context to admin activation endpoint","Modify POST /internal/activate-tenant in /services/api-gateway/src/routes/tenant.ts. Include saasProduct in the response: { success: true, tenant_id, status: 'active', saasProduct: tenant.saasProduct }. Log saasProduct in the activation console message. This gives the admin visibility into which product a tenant belongs to when activating. Do NOT modify the activation logic itself.",Done,PH-005,2026-02-14T10:00:00.000Z,2026-02-14T10:30:00.000Z
XTAG-001,XTAG,"Add saasProduct column to Workflow and AgentLog models","Add saasProduct String field (optional, nullable) to both the Workflow and AgentLog models in infrastructure/prisma/schema.prisma. Default to null for backwards compatibility. Add index on [saasProduct] on both models for analytics queries. Run prisma db push or generate migration. Do NOT modify any other models beyond Workflow and AgentLog.",Done,PH-006,2026-02-14T10:00:00.000Z,2026-02-14T12:10:00.000Z
XTAG-002,XTAG,"Tag Workflow records with saasProduct at creation","Modify the createWorkflow() method in /packages/agent-orchestrator/src/index.ts. The orchestrator already receives RulesEngine (which has SaaSConfig). Pass saasProduct (from this.rules config slug) into the Prisma workflow.create() data. This tags every workflow with the product that created it. Do NOT modify workflow processing, state transitions, or agent execution logic.",Done,PH-006,2026-02-14T10:00:00.000Z,2026-02-14T12:10:00.000Z
XTAG-003,XTAG,"Tag AgentLog records with saasProduct at creation","Modify the action logging in /packages/core-engine/src/index.ts (or wherever AgentLog records are created). When writing an AgentLog record, include saasProduct from the CoreEngine's SaaSConfig slug. This tags every agent execution log with the product context. Do NOT modify agent logic, scoring, or action execution.",Done,PH-006,2026-02-14T10:00:00.000Z,2026-02-14T12:10:00.000Z
XTAG-004,XTAG,"Add product filter to metrics endpoint","Modify /services/api-gateway/src/routes/metrics.ts. Add an optional query parameter ?product=saas-booker (or saas-leadqualifier, saas-followup). When provided, filter all Prisma queries (leads, meetings, messages, agentLogs) by joining through tenant.saasProduct or workflow.saasProduct. When not provided, return existing behavior (tenant-scoped only). This enables per-product metric comparison. Do NOT redesign the metrics response shape — add filtering only.",Done,PH-006,2026-02-14T10:00:00.000Z,2026-02-14T12:10:00.000Z
XTAG-005,XTAG,"Create GET /internal/experiment-stats admin endpoint","Create a new GET /internal/experiment-stats endpoint in /services/api-gateway/src/routes/tenant.ts. Protected by ADMIN_SECRET (same as activate-tenant). Returns per-product aggregated stats: { products: [{ slug, totalTenants, activeTenants, pendingTenants, totalWorkflows, completedWorkflows, totalLeads }] }. Query Prisma grouping by tenant.saasProduct and workflow.saasProduct. This is the primary experiment comparison endpoint. Auth-exempt, subscription-exempt. Only registered when PAYMENT_MODE=manual. Do NOT expose tenant PII (names, emails). Return counts only.",Done,PH-006,2026-02-14T10:00:00.000Z,2026-02-14T12:10:00.000Z
FEND-001,FEND,"Add POST /api/auth/login backend endpoint","Add a POST /api/auth/login endpoint to /services/api-gateway/src/routes/tenant.ts. Accept { email: string } in request body. Look up User by email in Prisma (include tenant relation to get tenantId and saasProduct). If user not found → 401 { error: 'Invalid credentials' }. If found, generate a JWT with { userId, tenantId, role, saasProduct } using the existing generateToken() function. Return { token, user, tenant }. This endpoint must be auth-exempt and subscription-exempt (add to both exempt path lists in auth.ts). No password verification in v1 — email-only login matching the existing no-password signup flow. Do NOT add session management, refresh tokens, or OAuth.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-002,FEND,"Scaffold frontend project with Vite + React + TypeScript + Tailwind","Create /apps/frontend as a new workspace. Initialize with Vite (react-ts template). Add dependencies: react-router-dom, tailwindcss, @tailwindcss/vite. Configure Tailwind via Vite plugin. Set up folder structure: src/pages/, src/components/, src/lib/, src/context/. Create src/lib/api.ts with a base fetch wrapper that reads VITE_API_URL env var and attaches Authorization: Bearer <token> header from localStorage. Create src/lib/config.ts that exports product config from VITE_SAAS_SLUG, VITE_PRODUCT_NAME, VITE_API_URL. Add to root package.json workspaces. Verify npm install and npm run build work. Do NOT add any pages yet — just the scaffold.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-003,FEND,"Implement auth context and protected route wrapper","Create src/context/AuthContext.tsx — React context that holds { token, user, tenant, isAuthenticated }. On mount, check localStorage for 'token' and 'user'. Provide login(token, user, tenant) and logout() methods. login() saves to localStorage and updates context. logout() clears localStorage and redirects to /login. Create src/components/ProtectedRoute.tsx — wrapper component that checks isAuthenticated from AuthContext. If not authenticated, redirect to /login. If authenticated, render children. Create src/components/Layout.tsx — minimal shell with header (product name, logout button) and main content area. Do NOT add navigation menus beyond a simple header.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-004,FEND,"Implement signup page","Create src/pages/Signup.tsx. Simple form: name (text input), email (email input), submit button. On submit, POST to /api/tenant/create with { name, email }. On success (201): call authContext.login(token, user, tenant) and redirect to /dashboard. On error (409 duplicate, 400 validation): show error message below form. Include a link to /login for existing users. Style with Tailwind — centered card, minimal. Show product name from config at top. Do NOT add password field, email verification, or terms checkbox.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-005,FEND,"Implement login page","Create src/pages/Login.tsx. Simple form: email (email input), submit button. On submit, POST to /api/auth/login with { email }. On success: call authContext.login(token, user, tenant) and redirect to /dashboard. On error (401): show 'Account not found' message. Include a link to /signup for new users. Style matching signup page. Show product name from config at top. Do NOT add password field or 'forgot password' flow.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-006,FEND,"Implement dashboard page with subscription status","Create src/pages/Dashboard.tsx. This is the main authenticated page. Display: product name, tenant name, subscription status badge (color-coded: green=active, yellow=pending, red=canceled/none), tenant ID (small text). Show quick action buttons: 'Submit Test Lead' (links to /leads), 'View Metrics' (links to /metrics). If subscription status is 'pending', show a notice: 'Your account is pending activation. Please contact support.' Style with Tailwind — clean card layout. Fetch tenant data from context (already loaded at login). Do NOT add charts, graphs, or real-time data.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-007,FEND,"Implement lead submission form","Create src/pages/Leads.tsx. Form with fields: name (text), email (email), company (text, optional), source (dropdown: website/referral/linkedin/other). On submit: POST to /api/leads with { name, email, company, source }. On success (201): show success message with lead ID, then auto-trigger POST /api/leads/:id/process to start AI processing. Show processing status: 'Lead submitted and queued for AI processing'. Include a 'Back to Dashboard' link. Style with Tailwind — centered form card. Do NOT add lead listing, search, or bulk import.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-008,FEND,"Implement metrics view page","Create src/pages/Metrics.tsx. On mount, GET /metrics (auth required — token sent automatically via api wrapper). Display metrics in a simple table or card grid: total leads, total meetings, total messages, total workflows, active workflows, MRR (if stripe mode), activation mode. Show last updated timestamp. Include a 'Refresh' button to re-fetch. Include a 'Back to Dashboard' link. Style with Tailwind — clean table or stat cards. Do NOT add charts, graphs, date filters, or export functionality.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-009,FEND,"Implement landing page with product-specific copy","Create src/pages/Landing.tsx. This is the public home page (/). Display: product name (large heading from VITE_PRODUCT_NAME), one-line tagline per product (hardcoded map: saas-booker='AI-powered meeting booking automation', saas-leadqualifier='AI-powered lead qualification automation', saas-followup='AI-powered follow-up automation'), two CTA buttons: 'Get Started' (→ /signup) and 'Log In' (→ /login). Minimal hero section only. Do NOT add features list, pricing, testimonials, or footer. Do NOT fetch any API data.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
FEND-010,FEND,"Configure React Router and product-specific builds","Create src/App.tsx with React Router configuration. Routes: / (Landing), /signup (Signup), /login (Login), /dashboard (Dashboard — protected), /leads (Leads — protected), /metrics (Metrics — protected). Wrap protected routes in ProtectedRoute component. Create src/main.tsx entry point with AuthProvider and BrowserRouter. Add build scripts to /apps/frontend/package.json: 'dev' (vite), 'build' (vite build), 'preview' (vite preview). Add 3 env files for local dev: .env.booker (VITE_SAAS_SLUG=saas-booker, VITE_API_URL=http://localhost:3001, VITE_PRODUCT_NAME=AI Booker), .env.leadqualifier, .env.followup — with corresponding values. Add npm scripts for each: 'dev:booker' (vite --mode booker), 'dev:qualifier' (vite --mode leadqualifier), 'dev:followup' (vite --mode followup). Verify build produces static output in dist/. Do NOT configure Railway deployment yet — that will be a separate phase.",Done,PH-007,2026-02-14T11:00:00.000Z,2026-02-14T11:30:00.000Z
